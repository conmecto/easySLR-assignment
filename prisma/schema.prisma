generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
    directUrl = env("DIRECT_URL")
}

model User {
    id            String   @id @default(cuid())
    name          String?
    email         String   @unique
    password      String 
    emailVerified DateTime?
    image         String?
    role          Role     @default(MEMBER)
    createdAt     DateTime @default(now())
    updatedAt     DateTime @updatedAt
    deletedAt     DateTime?
    
    // Relations
    organization   Organization? @relation("OrganizationUsers", fields: [organizationId], references: [id])
    organizationId String?
    invites        OrganizationInvite[] @relation("UserInvites")
}

model Organization {
    id        String   @id @default(cuid())
    name      String
    domain    String   @unique
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    deletedAt DateTime?

    // Relations
    users     User[]   @relation("OrganizationUsers")
    invites   OrganizationInvite[]
}

model OrganizationInvite {
    id             String   @id @default(cuid())
    email          String   @unique
    accepted       Boolean  @default(false)
    createdAt      DateTime @default(now())
    updatedAt      DateTime @updatedAt
    deletedAt      DateTime?

    // Relations
    organization   Organization @relation(fields: [organizationId], references: [id])
    organizationId String
    invitedBy      User        @relation("UserInvites", fields: [invitedById], references: [id])
    invitedById    String

    @@index([organizationId])
    @@index([invitedById])
}

enum Role {
    ADMIN
    MEMBER
}
